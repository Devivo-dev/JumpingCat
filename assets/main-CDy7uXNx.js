(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))c(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function o(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(i){if(i.ep)return;i.ep=!0;const s=o(i);fetch(i.href,s)}})();function a(){const e=document.querySelector(".game__coin"),n=document.querySelector(".game__cloud"),o=document.querySelector(".game"),c=e.offsetHeight,i=e.offsetWidth,s=n.getBoundingClientRect(),r=o.getBoundingClientRect(),l=s.bottom-r.top,y=o.clientHeight-c,p=l+Math.random()*(y-l),g=Math.random()*(o.clientWidth-i);e.style.left=g+"px",e.style.top=p+"px",e.style.display="block",clearTimeout(e.despawnTimer),e.despawnTimer=setTimeout(()=>{e.style.display==="block"&&(e.style.display="none",a())},5e3)}const t={score:0,coins:0,velocityX:0,velocityY:0,posX:0,posY:0};function h(e,n){const o=e.getBoundingClientRect(),c=n.getBoundingClientRect();return!(o.right<c.left||o.left>c.right||o.bottom<c.top||o.top>c.bottom)}function v(e){return e>=1e6?(e/1e6).toFixed(1).replace(".",",")+"M":e>=1e3?(e/1e3).toFixed(1).replace(".",",")+"k":e.toString()}function d(){const e=document.querySelector(".game__player"),n=document.querySelector(".game"),o=document.querySelector(".score__value--points"),c=document.querySelector(".score__value--player"),i=document.querySelector(".game__coin");o.textContent=t.score,t.velocityY+=.5,t.posY+=t.velocityY,t.posX+=t.velocityX;const s=n.clientHeight,r=n.clientWidth;t.posY<0&&(t.posY=0,t.velocityY=0),t.posY+e.offsetHeight>=s&&(t.posY=s-e.offsetHeight,t.velocityY=0),t.posX<0&&(t.posX=0,t.velocityX=0),t.posX+e.offsetWidth>=r&&(t.posX=r-e.offsetWidth,t.velocityX=0),e.style.top=t.posY+"px",e.style.left=t.posX+"px",h(e,i)&&(t.coins++,c.textContent=v(t.coins),i.style.display="none",clearTimeout(i.despawnTimer),setTimeout(a,2e3)),requestAnimationFrame(d)}function _(){const e=window.innerWidth;return e<400?2:e<768?5:4}function w(){const e=window.innerWidth;return e<400?7:(e<768,10)}const u=_(),m=w();function S(){t.velocityY=-m,t.velocityX=-u,t.score++,document.querySelector(".control__button--left").classList.add("active"),setTimeout(()=>{document.querySelector(".control__button--left").classList.remove("active")},150),document.querySelector(".game__player").style.transform="scaleX(-1)"}function L(){t.velocityY=-m,t.velocityX=u,t.score++,document.querySelector(".control__button--right").classList.add("active"),setTimeout(()=>{document.querySelector(".control__button--right").classList.remove("active")},150),document.querySelector(".game__player").style.transform="scaleX(1)"}window.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".retry-btn");e&&e.addEventListener("click",()=>{e.classList.add("active"),setTimeout(()=>{e.classList.remove("active"),document.querySelector(".modal").classList.add("hidden"),location.reload()},250)})});function q(){document.querySelector(".control__button--left").addEventListener("click",S),document.querySelector(".control__button--right").addEventListener("click",L);const e=document.querySelector(".modal__retry");e.addEventListener("click",()=>{e.classList.add("active"),setTimeout(()=>{e.classList.remove("active")},150),setTimeout(()=>{location.reload()},1e3)})}class C{constructor(){const{tg_id:n}=PlayerService.getCurrentPlayer();this.tg_id=n}async getWhiskas(){const{data:n,error:o}=await supabaseClient.from("players").select("whiskas").eq("tg_id",this.tg_id).single();if(o)throw new Error("❌ Помилка при getWhiskas()");return{data:n,error:o}}async updateWhiskas(n){const o=await this.getWhiskas()+n,{error:c}=await supabaseClient.from("players").update({whiskas:o});return{error:c}}}const f=new C;async function b(){const e=t.coins;localStorage.setItem("whiskas-amount",e.toString()),await f.updateWhiskas(e)}console.log("🟡 onGameOver() викликано");function W(e){const n=document.querySelector(".game__start-message");let o=3;n.textContent=o;const c=setInterval(()=>{o--,n.textContent=o>0?o:"Start!",o<0&&(clearInterval(c),n.textContent="",e())},1e3)}function k(){a(),W(()=>d()),q()}const E=["../../../public/img/btn-retry.png","../../../public/img/btn-retry-active.png","../../../public/img/EndGame.png"];E.forEach(e=>{const n=new Image;n.src=e});document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("back-to-menu");e&&e.addEventListener("click",async n=>{n.preventDefault(),e.classList.add("active"),await new Promise(o=>setTimeout(o,300)),await b(),window.location.href="./index.html"})});window.addEventListener("DOMContentLoaded",()=>{window.location.pathname.includes("game.html")&&k(),document.addEventListener("gesturestart",c=>c.preventDefault()),document.addEventListener("gesturechange",c=>c.preventDefault()),document.addEventListener("gestured",c=>c.preventDefault());const e=document.querySelector("#whiskas-amount"),n=document.querySelector(".coin-collected");f.getWhiskas().then(c=>{e&&(e.textContent=c)});const o=localStorage.getItem("coins_collected");o!==null&&n&&(n.textContent=o,localStorage.removeItem("coins_collected"))});
